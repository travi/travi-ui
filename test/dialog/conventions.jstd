travi.test.testCase('dialog conventions', (function () {
    'use strict';

    var conventions = travi.ui.dialog.conventions,
        dialog = travi.ui.dialog.simple,

        url = 'someUrl';

    return {
        setUp: function () {
            $('body')
                .append('<a href="' + url + '" class="dialog-target"></a>')
                .append('<a href="' + url + '" class="different-class"></a>');

            sinon.stub(dialog, 'loadFromUrl');

            conventions.init();
        },

        tearDown: function () {
            travi.test.common.restore([
                dialog.loadFromUrl
            ]);
            $('body').off();
        },


        'test that clicking on a link with the dialog-target class loads dialog from href': function () {
            var clickEvent = new $.Event('click');

            $('a.dialog-target').trigger(clickEvent);

            sinon.assert.calledWith(dialog.loadFromUrl, url);
            assertTrue(clickEvent.isDefaultPrevented());
        },

        'test that link without dialog-target link does not load dialog': function () {
            $('a.different-class').click();

            sinon.assert.notCalled(dialog.loadFromUrl);
        },

        'test that dialog launched from link added after initialization': function () {
            $('body').append('<a href="#" class="dialog-target new"></a>');

            $('a.new').click();

            sinon.assert.calledOnce(dialog.loadFromUrl);
        }
    };
}()));